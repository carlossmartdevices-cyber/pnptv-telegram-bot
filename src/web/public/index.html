<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>PNPtv Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="styles.css?v=2.0.1" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  </head>
  <body>
    <div id="app">
      <!-- Loading Screen -->
      <div id="loading" class="screen active">
        <div class="loader"></div>
        <p>Loading PNPtv...</p>
      </div>

      <!-- Login Overlay -->
      <div id="login-overlay" class="screen hidden">
        <div class="login-card">
          <h1>Join PNPtv</h1>
          <p>Sign in with Telegram to access the community.</p>
          <div
            id="telegram-login-placeholder"
            class="telegram-login-placeholder"
          ></div>
          <p id="login-feedback" class="login-feedback hidden"></p>
          <button id="open-in-telegram-btn" class="btn btn-primary hidden">
            Open in Telegram
          </button>
        </div>
      </div>

      <!-- Welcome Overlay -->
      <div id="welcome-overlay" class="welcome-overlay hidden">
        <div class="welcome-content">
          <h1>Welcome to PNPtv</h1>
          <p>Connect with like-minded people near you</p>
          <div id="welcome-telegram-login"></div>
          <div class="telegram-button" onclick="openTelegramApp()">
            <i class="material-icons">smart_toy</i>
            Open in Telegram
          </div>
        </div>
      </div>

      <!-- Main Navigation -->
      <nav id="main-nav" class="hidden">
        <button class="nav-btn active" data-page="profile">
          <span class="material-icons">person</span>
          <span>Profile</span>
        </button>
        <button class="nav-btn" data-page="map">
          <span class="material-icons">map</span>
          <span>Map</span>
        </button>
        <button class="nav-btn" data-page="live">
          <span class="material-icons">live_tv</span>
          <span>Live</span>
        </button>
        <button class="nav-btn" data-page="premium">
          <span class="material-icons">star</span>
          <span>Premium</span>
        </button>
      </nav>

      <button id="new-post-btn" class="fab hidden" type="button">
        <span class="material-icons">add</span>
        <span class="fab-label">New Post</span>
      </button>

      <!-- Profile Page -->
      <div id="profile-page" class="page hidden">
        <div class="page-header">
          <h1>My Profile</h1>
        </div>
        <div class="profile-content">
          <div class="profile-photo-wrapper">
            <div id="profile-photo" class="profile-photo">
              <span class="photo-placeholder">👤</span>
            </div>
          </div>
          <div class="profile-info">
            <h2 id="profile-username">Loading...</h2>
            <div class="profile-tier" id="profile-tier"></div>
            <div class="profile-stats">
              <div class="stat">
                <span class="stat-label">XP</span>
                <span class="stat-value" id="profile-xp">0</span>
              </div>
              <div class="stat">
                <span class="stat-label">Badges</span>
                <span class="stat-value" id="profile-badges">0</span>
              </div>
            </div>
          </div>
          <div class="profile-meta">
            <div class="meta-row">
              <span class="meta-label">Member since</span>
              <span class="meta-value" id="profile-joined-text">—</span>
            </div>
            <div class="meta-row">
              <span class="meta-label">Last active</span>
              <span class="meta-value" id="profile-last-active-text">—</span>
            </div>
          </div>
          <div class="profile-bio">
            <h3>Bio</h3>
            <p id="profile-bio-text">No bio set</p>
            <button id="edit-bio-btn" class="btn btn-secondary">
              Edit Bio
            </button>
          </div>
          <div class="profile-location">
            <h3>Location</h3>
            <p id="profile-location-text">Not set</p>
            <p
              id="profile-coordinates-text"
              class="location-coordinates hidden"
            >
              —
            </p>
            <button id="edit-location-btn" class="btn btn-secondary">
              Update Location
            </button>
          </div>
          <div class="membership-card">
            <div class="membership-card__header">
              <h3>Membership</h3>
              <span class="membership-status" id="membership-status">Free</span>
            </div>
            <div class="membership-card__body">
              <div class="membership-row">
                <span class="membership-label">Tier</span>
                <span class="membership-value" id="membership-tier-value"
                  >Free</span
                >
              </div>
              <div class="membership-row">
                <span class="membership-label">Expires</span>
                <span class="membership-value" id="membership-expires-value"
                  >—</span
                >
              </div>
              <div class="membership-row">
                <span class="membership-label">Status</span>
                <span class="membership-value" id="membership-days-remaining"
                  >Unlimited</span
                >
              </div>
            </div>
            <button
              id="open-subscribe-btn"
              class="btn btn-secondary membership-cta"
            >
              Manage Membership
            </button>
          </div>
        </div>
      </div>

      <!-- Map Page -->
      <div id="map-page" class="page hidden">
        <div class="page-header">
          <h1>Nearby Users</h1>
          <div class="radius-selector">
            <button class="radius-btn active" data-radius="5">5km</button>
            <button class="radius-btn" data-radius="10">10km</button>
            <button class="radius-btn" data-radius="25">25km</button>
            <button class="radius-btn" data-radius="50">50km</button>
          </div>
        </div>
        <div class="map-content">
          <button id="share-location-btn" class="btn btn-primary">
            <span class="material-icons">location_on</span>
            Share My Location
          </button>
          <div id="map-summary" class="map-summary hidden">
            <span class="map-location" id="map-location-label"
              >Location not set</span
            >
            <span class="map-radius"
              >Radius: <strong id="map-radius-label">25 km</strong></span
            >
          </div>
          <div id="users-list" class="users-list">
            <p class="empty-state">Share your location to see nearby users</p>
          </div>
        </div>
      </div>

      <!-- Live Streams Page -->
      <div id="live-page" class="page hidden">
        <div class="page-header">
          <h1>Live Streams</h1>
        </div>
        <div class="live-content">
          <div class="coming-soon">
            <span class="icon-large">📺</span>
            <h2>Live Streaming</h2>
            <p>Coming Soon!</p>
            <p class="description">
              Watch and stream live content with the PNPtv community
            </p>
          </div>
        </div>
      </div>

      <!-- Premium Page -->
      <div id="premium-page" class="page hidden">
        <div class="page-header">
          <h1>Premium Plans</h1>
        </div>
        <div class="premium-content">
          <div id="plans-container"></div>
        </div>
      </div>
    </div>

    <!-- New Post Modal -->
    <div id="new-post-modal" class="modal hidden">
      <div class="modal-content">
        <h2>Create Post</h2>
        <form id="new-post-form">
          <textarea
            id="post-text-input"
            placeholder="Share something with the community..."
            maxlength="2000"
          ></textarea>
          <div class="media-upload">
            <label for="post-media-input" class="btn btn-secondary"
              >Add Photos or Videos</label
            >
            <input
              id="post-media-input"
              type="file"
              accept="image/*,video/*"
              multiple
              hidden
            />
            <p class="media-hint">You can attach up to 4 files.</p>
            <ul id="media-preview-list" class="media-preview-list hidden"></ul>
          </div>
          <div class="modal-actions">
            <button
              type="button"
              id="cancel-post-btn"
              class="btn btn-secondary"
            >
              Cancel
            </button>
            <button type="submit" id="submit-post-btn" class="btn btn-primary">
              Publish
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Bio Modal -->
    <div id="bio-modal" class="modal hidden">
      <div class="modal-content">
        <h2>Edit Bio</h2>
        <textarea
          id="bio-input"
          placeholder="Tell us about yourself..."
          maxlength="200"
        ></textarea>
        <div class="modal-actions">
          <button id="cancel-bio-btn" class="btn btn-secondary">Cancel</button>
          <button id="save-bio-btn" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>

    <script src="app.js?v=2.0.1"></script>
  </body>
</html>
